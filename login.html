<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Secure Login and OTP Template</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for 'Inter' font -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-red': '#C8102E', // Mimicking the deep red from the button
                        'sub-text': '#525252',
                        'nav-bg': '#333333', // Dark background for the sidebar
                        'nav-active': '#C8102E', // Red for active menu item
                        'pasti-red': '#C8102E', // Alias for the primary red color
                        'pasti-dark': '#1e1e1e', // Darker background color for a more professional feel
                    }
                }
            }
        }
    </script>
    <!-- Inter Font Import -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Custom Style for the distinct logo text -->
    <style>
        .logo-text {
            font-family: 'Dancing Script', cursive; /* Using a cursive font to simulate the unique logo */
            font-size: 3rem;
            line-height: 1;
            color: #C8102E;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .app-logo-text {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: #ffffff;
            font-weight: 700;
        }
        /* Styling for the red bar under the search/reset buttons */
        .search-container {
            border-bottom: 3px solid #C8102E;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
    </style>
    <!-- Import a beautiful script font for the logo -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-0 md:p-4 font-sans">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="absolute inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300 hidden">
        <div class="flex flex-col items-center">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-primary-red"></div>
            <p class="mt-4 text-white text-sm">Initializing...</p>
        </div>
    </div>

    <!-- Login Card Container -->
    <div id="loginCard" class="w-full max-w-sm bg-white rounded-xl shadow-2xl overflow-hidden transform transition duration-500 hover:scale-[1.01] hidden">

        <!-- Header Section -->
        <div class="p-8 text-center border-b border-gray-100">
            <h1 class="text-xs font-bold tracking-widest text-gray-500 mb-1 uppercase">AHM</h1>
            <div class="logo-text">Pasti</div>
        </div>

        <!-- Form Body -->
        <div class="p-8 space-y-6">
            <form id="loginForm" class="space-y-6" onsubmit="handleLogin(event)">

                <!-- Username Field (will use as Email for Firebase Auth) -->
                <div class="relative">
                    <input type="email" id="email" placeholder="Email" required
                           class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-primary-red focus:border-primary-red transition duration-150 text-sub-text placeholder-gray-400 focus:outline-none shadow-sm">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                        <!-- User Icon (SVG from Lucide) -->
                        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                        </svg>
                    </span>
                </div>

                <!-- Password Field -->
                <div class="relative">
                    <input type="password" id="password" placeholder="Password" required
                           class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-primary-red focus:border-primary-red transition duration-150 text-sub-text placeholder-gray-400 focus:outline-none shadow-sm">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                        <!-- Lock Icon (SVG from Lucide) -->
                        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                        </svg>
                    </span>
                </div>

                <!-- Login Button -->
                <button type="submit" id="loginButton"
                        class="w-full flex items-center justify-center py-3 bg-primary-red text-white font-semibold rounded-lg shadow-lg hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus:ring-4 focus:ring-primary-red focus:ring-opacity-50 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="buttonText" class="mr-2 text-xl">&rarr;</span>
                    <span id="buttonLoading" class="hidden animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></span>
                    <span id="buttonLabel">LOGIN</span>
                </button>
            </form>

            <!-- Links Section (Register / Forgot) -->
            <div class="text-center text-xs space-x-3 text-sub-text">
                <a href="#" onclick="handleRegister(event)" class="hover:text-primary-red transition duration-150 inline-block py-1">Register</a> |
                <a href="#" class="hover:text-primary-red transition duration-150 inline-block py-1">Forgot Password</a> |
                <a href="#" class="hover:text-primary-red transition duration-150 inline-block py-1">Forgot Username</a> |
                <a href="#" class="hover:text-primary-red transition duration-150 inline-block py-1">Unlock Account</a>
            </div>
            <div class="text-center text-xs text-sub-text">
                <a href="#" class="hover:text-primary-red transition duration-150 inline-block py-1">Forgot Email</a>
            </div>

            <!-- Custom Message Box -->
            <div id="messageBox" class="hidden p-3 rounded-lg text-sm transition-all duration-300 mt-4" role="alert"></div>

        </div>

        <!-- Footer Section -->
        <div class="p-4 text-center text-xs text-gray-400 border-t border-gray-100">
            &copy; 2024 Placeholder Corporation
        </div>

    </div>

    <script>
        // --- LOCAL STORAGE SETUP ---
        let isAuthReady = true; // Always ready for local storage
        let isLoggedIn = false; // Track simulated login state

        const loadingOverlay = document.getElementById('loadingOverlay');
        const loginCard = document.getElementById('loginCard');
        const loginButton = document.getElementById('loginButton');
        const buttonText = document.getElementById('buttonText');
        const buttonLoading = document.getElementById('buttonLoading');
        const buttonLabel = document.getElementById('buttonLabel');

        // Define inbuilt credentials and simulated OTP
        const INBUILT_EMAIL = 'test@pasti.com';
        const INBUILT_PASSWORD = 'password123';
        const SIMULATED_OTP = '123456';
        const CREDENTIALS_STORAGE_KEY = 'pasti_credentials';

        // Global utility function for displaying messages (replaces alert())
        // Targets the general message box on the Login Card unless a specific ID is provided
        window.displayMessage = function(text, isError = true, messageBoxId = 'messageBox') {
            const box = document.getElementById(messageBoxId);
            if (!box) return;

            box.textContent = text;
            box.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');

            if (isError) {
                box.classList.add('bg-red-100', 'text-red-700');
            } else {
                box.classList.add('bg-green-100', 'text-green-700');
            }

            // Show the box (in case it was hidden by the timeout before)
            box.classList.remove('hidden');

            setTimeout(() => {
                box.classList.add('hidden');
            }, 5000);
        }

        function toggleLoginLoading(isLoading) {
            loginButton.disabled = isLoading;
            buttonText.classList.toggle('hidden', isLoading);
            buttonLoading.classList.toggle('hidden', !isLoading);
            buttonLabel.textContent = isLoading ? 'PROCESSING...' : 'LOGIN';
        }

        function initializeApp() {
            loadingOverlay.classList.remove('hidden');

            // Simulate initialization delay
            setTimeout(() => {
                isAuthReady = true;
                loadingOverlay.classList.add('hidden');

                // Check simulated session state to decide where to land
                const simulatedLogin = localStorage.getItem('simulated_login');
                const otpPassed = localStorage.getItem('simulated_otp_passed');

                if (simulatedLogin && otpPassed === 'true') {
                     window.location.href = 'index.html';
                } else if (simulatedLogin) {
                     window.location.href = 'otp.html';
                } else {
                     loginCard.classList.remove('hidden');
                }
            }, 1000); // Simulate 1 second loading
        }

        window.handleLogin = async function(event) {
            event.preventDefault();

            toggleLoginLoading(true);

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                // Check credentials against localStorage first
                const existingCreds = JSON.parse(localStorage.getItem(CREDENTIALS_STORAGE_KEY) || '{}');

                if (existingCreds[email] && existingCreds[email].password === password) {
                    // Stored credentials match - proceed to OTP
                    displayMessage('Login successful! A verification code has been sent.', false);
                    localStorage.setItem('simulated_login', existingCreds[email].uid);
                    setTimeout(() => window.location.href = 'otp.html', 1000);
                    return;
                }

                // Check against hardcoded values if not in localStorage
                if (email === INBUILT_EMAIL && password === INBUILT_PASSWORD) {
                    // Hardcoded Login Success! Now proceed to OTP step.
                    displayMessage('Login successful! A verification code has been sent.', false);
                    localStorage.setItem('simulated_login', 'guest-user');
                    setTimeout(() => window.location.href = 'otp.html', 1000);
                    return;
                }

                // Accept any credentials as per requirement
                displayMessage('Login successful! A verification code has been sent.', false);
                localStorage.setItem('simulated_login', 'guest-user');
                setTimeout(() => window.location.href = 'otp.html', 1000);

            } catch (error) {
                console.error("Login attempt failed:", error);
                displayMessage(`Login failed unexpectedly: ${error.message}`, true);
            } finally {
                toggleLoginLoading(false);
            }
        }

        window.handleRegister = async function(event) {
            event.preventDefault();
            if (!isAuthReady) {
                 displayMessage("Authentication service is not ready yet. Please wait.", true);
                 return;
            }

            toggleLoginLoading(true);
            buttonLabel.textContent = 'REGISTERING...';

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (password.length < 6) {
                displayMessage('Password must be at least 6 characters long.', true);
                toggleLoginLoading(false);
                buttonLabel.textContent = 'LOGIN';
                return;
            }

            try {
                const existingCreds = JSON.parse(localStorage.getItem(CREDENTIALS_STORAGE_KEY) || '{}');

                if (existingCreds[email]) {
                    displayMessage('This email is already registered. Please log in.', true);
                    return;
                }

                const uid = 'user_' + Date.now();
                existingCreds[email] = {
                    email: email,
                    password: password,
                    uid: uid,
                    createdAt: new Date().toISOString()
                };

                localStorage.setItem(CREDENTIALS_STORAGE_KEY, JSON.stringify(existingCreds));

                displayMessage('Registration successful! You can now use your email/password to log in.', false);

            } catch (error) {
                console.error("Registration failed:", error);
                let errorMessage = "Registration failed.";
                displayMessage(errorMessage, true);
            } finally {
                toggleLoginLoading(false);
                buttonLabel.textContent = 'LOGIN';
            }
        }

        // Start initialization on window load
        initializeApp();
    </script>
</body>
</html>
