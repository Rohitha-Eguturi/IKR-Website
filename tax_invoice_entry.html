<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasti - Verification Transaction - Tax Invoice Entry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Custom Tailwind Configuration
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-red': '#e74c3c',
                        'nav-bg': '#000080', 
                        'nav-active-bg': '#0000AA',
                        'nav-active-border': '#0000FF',
                        'table-header-bg-main': '#bdc3c7',
                        'table-header-bg-sub': '#ecf0f1',
                        'pasti-blue': '#3498db',
                        'search-button-blue': '#3498db',
                        'back-button-red': '#e74c3c',
                        'pasti-dark-blue': '#293547', 
                        'success-message-green': '#2ecc71', 
                        'warning-orange': '#f39c12',
                        'submit-blue': '#2C7AAB', /* Custom blue from mockup */
                        'cancel-red': '#D9534F', /* Custom red from mockup */
                    }
                }
            }
        }
    </script>
    <style>
        /* Base styles */
        body {
            background-color: #f0f0f0; 
            font-family: Arial, sans-serif;
            margin: 0;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar Styles (unchanged) */
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding-top: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            overflow-y: auto;
        }

        .logo-section {
            padding: 10px 20px;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .menu-item {
            padding: 10px 20px;
            cursor: pointer;
            border-left: 3px solid transparent;
            font-size: 14px;
        }

        .menu-item:hover, .menu-item.active {
            background-color: #0000AA;
            border-left: 3px solid #3498db;
        }

        .menu-item.expandable {
            cursor: pointer;
        }

        .sub-menu {
            padding-left: 20px;
        }

        .sub-menu.hidden {
            display: none;
        }

        .arrow {
            float: right;
            transition: transform 0.3s;
        }

        .arrow.expanded {
            transform: rotate(90deg);
        }

        .sub-item {
            padding: 5px 20px;
            cursor: pointer;
        }

        .sub-item:hover {
            background-color: #0000AA;
            border-left: 3px solid #3498db;
        }

        .menu-item-group {
            font-size: 12px;
            font-weight: bold;
            padding: 10px 20px 5px;
            color: #bdc3c7;
        }

        /* Form styling for ENTRY SCREEN */
        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .form-label {
            /* Only applies to entry screen now */
            min-width: 160px; 
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }
        
        /* Input styling for ENTRY SCREEN */
        .form-input {
            border: 1px solid #ccc;
            padding: 6px 10px;
            border-radius: 4px;
            width: 100%;
            font-size: 14px;
            color: #333;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .form-input:focus {
            border-color: #3498db;
            outline: 0;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.25);
        }
        
        /* New style for read-only text fields in verification screen (no borders/padding) */
        .read-only-value {
            font-size: 14px;
            color: #000;
            font-weight: 500;
            padding: 6px 0; /* Align vertical spacing with input fields */
            display: block;
        }
        
        /* Styles for the detail screen table */
        .data-table th, .data-table td {
            white-space: nowrap; /* Prevents wrapping in table cells */
        }
        
        /* Custom row style for Verification Screen single column */
        .verification-row {
            display: grid;
            grid-template-columns: 160px 1fr; /* Label fixed width, value flexible */
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            padding: 4px 0;
        }
        
        /* Highlighted row for Total Amount */
        .total-amount-row {
            background-color: #ecf0f1; /* Light gray background */
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px 10px;
            margin-bottom: 12px;
            /* Use grid to align content */
            display: grid; 
            grid-template-columns: 160px 1fr; 
            align-items: center;
            gap: 10px;
        }
        
    </style>
</head>
<body class="bg-[#f0f0f0]">

<div class="app-container">

    <!-- Sidebar (unchanged) -->
    <div class="sidebar">
        <div class="logo-section">Pasti</div>
        <hr style="border-color: #0000AA;">
        <div class="menu-item-group">MENU</div>
        <div class="menu-item">IT Service Management</div>
        <div class="menu-item">Finance & Accounting</div>
        <div class="menu-item">E-Filing</div>
        <div class="menu-item expandable" id="eVerifyMenu">E-Verify <span class="arrow">‚ñ∂</span></div>
        <div class="sub-menu hidden" id="eVerifySubMenu">
            <div class="menu-item sub-item" onclick="window.location.href='registry_dropbox.html'">Registry Dropbox</div>
        </div>
        <div class="menu-item">Maintain Master Method</div>
        <div class="menu-item active">Verification Transaction</div>
        <div class="menu-item">Re-Print Verification</div>
        <div class="menu-item">Tax Invoice Process</div>
        <div class="menu-item">e-Verify</div>
        <div class="menu-item">Monitoring Transaction</div>
        <div class="menu-item">Upload Data Payment Invoice</div>
        <div class="menu-item-group" style="margin-top: 20px;">AHM-PASTI</div>
    </div>

    <div class="flex-1 flex flex-col bg-white overflow-hidden">
        
        <!-- Top Navigation Bar (unchanged) -->
        <div class="flex justify-between items-center bg-primary-red text-white p-2 text-sm shadow-md flex-shrink-0">
            <div class="flex">
                <div class="px-3 cursor-pointer hover:bg-white hover:text-gray-800 rounded-t-lg">üè† Home</div>
                <div class="px-3 bg-white text-gray-800 font-semibold rounded-t-lg" id="verificationTransactionTab">Verification Transaction <span class="ml-2 cursor-pointer">x</span></div>
            </div>
            <div>6 Nov 2025 14:20:47</div> 
        </div>

        <!-- Tab Bar: Tabs visibility and active state are managed by JavaScript -->
        <div class="w-full bg-gray-100 border-b border-gray-300 flex-shrink-0" id="tabBar">
            <div class="flex items-center text-sm">
                <!-- Tab 1: Base -->
                <div class="bg-gray-200 border-r border-gray-300 py-2 px-4 font-semibold text-gray-700">Verification Transaction</div>
                
                <!-- Tab 2: Entry Document Data (always gray) -->
                <div class="bg-gray-200 border-r border-gray-300 py-2 px-4 font-semibold text-gray-700">Entry Document Data (ahmfainv027ip02)</div>
                
                <!-- Tab 3: Receipt Entry (Step 1) -->
                <div class="bg-white border-b-2 border-primary-red py-2 px-4 font-semibold text-gray-900 flex items-center tab-item" id="receiptEntryTab">
                    Entry Tax Invoice (ahmfainv027ip01)
                </div>

                <!-- Tab 4: Transaction Verification (Step 2) -->
                <div class="bg-gray-200 border-r border-gray-300 py-2 px-4 font-semibold text-gray-700 hidden tab-item" id="verificationTab">
                    Transaction Verification (ahmfainv027ip03)
                </div>

                <!-- Tab 5: Ref Document Detail (Step 3, after Save) -->
                <div class="bg-gray-200 border-r border-gray-300 py-2 px-4 font-semibold text-gray-700 hidden tab-item" id="detailTab">
                    Ref Document Detail (ahmfainv027ip07)
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 p-4 overflow-y-auto">
            
            <!-- Step 1: Receipt Entry Form (Initially visible) - Centered -->
            <div id="entryScreen" class="block">
                <h1 class="text-lg font-bold mb-4 text-gray-800 border-b pb-2">Entry Tax Invoice (ahmfainv027ip01)</h1>
                <div class="max-w-xl mx-auto mt-8">
                    
                    <!-- Receipt No Row -->
                    <div class="form-row">
                        <span class="form-label">Receipt No. <span class="text-primary-red">*</span></span>
                        <input type="text" id="receiptNo" value="1234561" placeholder="Enter Receipt Number" class="form-input w-64" required>
                    </div>

                    <!-- Receipt Date Row -->
                    <div class="form-row">
                        <span class="form-label">Receipt Date <span class="text-primary-red">*</span></span>
                        <input type="date" id="receiptDate" value="2025-10-22" class="form-input w-64" required>
                    </div>
                    
                    <!-- Action Buttons - Centered -->
                    <div class="flex justify-center space-x-4 mt-8"> 
                        <button id="submitButton" class="bg-submit-blue hover:bg-[#1F6E8C] text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c.55 0 1 .45 1 1s-.45 1-1 1h-2c-.55 0-1-.45-1-1s.45-1 1-1h2zm-2-7H7V4h10v2z"></path></svg>
                            Submit
                        </button>
                        <button id="cancelButton" class="bg-cancel-red hover:bg-[#C9302C] text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            Cancel
                        </button>
                    </div>
                </div>
            </div> <!-- End Entry Screen -->

            <!-- Step 2: Transaction Verification Screen - Single Column Layout -->
            <div id="verificationScreen" class="hidden">
                
                <!-- Centering Wrapper applied here (max-w-xl for single column) -->
                <div class="max-w-xl mx-auto">
                    
                    <h1 class="text-lg font-bold mb-4 text-gray-800 border-b pb-2">Transaction Verification (Receipt Certain Period Method)</h1>

                    <p class="mb-4 text-sm text-gray-700">You will claim an invoice with the following data:</p>
                    
                    <!-- Single Column Stack for Verification Data -->
                    <div class="text-sm space-y-2">
                        
                        <!-- 1. Company -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Company</span>
                            <span class="read-only-value">PT. DYNAPLAST Tbk</span>
                        </div>

                        <!-- 2. Transaction -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Transaction</span>
                            <span class="read-only-value">Total Company</span>
                        </div>
                        
                        <!-- 3. Currency -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Currency</span>
                            <span class="read-only-value">IDR</span>
                        </div>

                        <!-- 4. Receipt No. -->
                        <div class="verification-row">
                            <span class="w-[160px] font-semibold text-gray-700">Receipt No.</span>
                            <span class="read-only-value" id="displayReceiptNoSpan">1234561</span>
                        </div>
                        
                        <!-- 5. Receipt Date -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Receipt Date</span>
                            <span class="read-only-value" id="displayReceiptDateSpan">22-OCT-2025</span>
                        </div>
                        
                        <!-- 6. Tax Code -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Tax Code</span>
                            <span class="read-only-value">VR VAT in Local</span>
                        </div>
                        
                        <!-- 7. PPN -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">PPN</span>
                            <span class="read-only-value text-right">320,000.00</span>
                        </div>

                        <!-- 8. PPnBM -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">PPnBM</span>
                            <span class="read-only-value text-right">0</span>
                        </div>
                        
                        <!-- 9. Ppn 22-01 -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Ppn 22-01</span>
                            <span class="read-only-value text-right">0</span>
                        </div>

                        <!-- 10. Amount -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Amount</span>
                            <span class="read-only-value text-right">3,200,000.00</span>
                        </div>
                        
                        <!-- 11. Tax Invoice No. -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Tax Invoice No.</span>
                            <span class="read-only-value">001.000-24.12345678</span>
                        </div>
                        
                        <!-- 12. Tax Invoice Date -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Tax Invoice Date</span>
                            <span class="read-only-value">22-OCT-2025</span>
                        </div>
                        
                        <!-- 13. Bukti Pungut No -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Bukti Pungut No</span>
                            <span class="read-only-value"></span>
                        </div>

                        <!-- 14. Bukti Pungut Date -->
                        <div class="verification-row">
                            <span class="font-semibold text-gray-700">Bukti Pungut Date</span>
                            <span class="read-only-value"></span>
                        </div>

                        <!-- 15. Total Amount (Highlighted Row) -->
                        <div class="total-amount-row mt-4">
                            <span class="font-extrabold text-gray-800 text-left">Total Amount</span>
                            <span class="read-only-value text-right font-extrabold text-lg pt-0 pb-0">3,520,000.00</span>
                        </div>
                        
                        <!-- 16. Terms of Payment (days) -->
                        <div class="verification-row w-full mt-4">
                            <span class="font-semibold text-gray-700">Terms of Payment (days)</span>
                            <span class="read-only-value">30</span>
                        </div>
                    </div> <!-- End Single Column Stack -->
                    
                    <!-- Warning text: Centered -->
                    <p class="mt-6 mb-8 text-sm text-gray-700 font-semibold border-t pt-4 border-gray-300 text-center">
                        Warning: This Verification can not be changed! To cancel, press Cancel button
                    </p>

                    <!-- Action Buttons for Verification Screen: Centered -->
                    <div class="flex justify-center space-x-4"> 
                        <button id="saveButton" class="bg-submit-blue hover:bg-[#1F6E8C] text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 13H5v-2h14v2zm-4-4H9V7h6v2z"></path></svg>
                            Save
                        </button>
                        <button id="cancelVerificationButton" class="bg-cancel-red hover:bg-[#C9302C] text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            Cancel
                        </button>
                    </div>

                </div> <!-- End Centering Wrapper -->

            </div> <!-- End Verification Screen -->
            
            <!-- Step 3: Ref Document Detail Screen (After Save) -->
            <div id="detailScreen" class="hidden">
                <h1 class="text-lg font-bold mb-4 text-gray-800 border-b pb-2">Ref Document Detail (ahmfainv027ip07)</h1>

                <!-- Centering Wrapper applied here (max-w-6xl for the wider content) -->
                <div class="max-w-6xl mx-auto">

                    <!-- Summary Details & Action Button -->
                    <div class="flex justify-between items-start mb-6 p-4 rounded-lg bg-gray-100 border border-gray-300 shadow-sm">
                        
                        <!-- Summary Detail Fields (Grid layout for left/right alignment) -->
                        <div class="grid grid-cols-4 gap-x-8 gap-y-2 text-sm max-w-lg">
                            <div class="font-semibold text-gray-700 col-span-2">Verification Date:</div> <div class="col-span-2" id="detailVerificationDate">06-NOV-2025</div>
                            <div class="font-semibold text-gray-700 col-span-2">Verification Time:</div> <div class="col-span-2" id="detailVerificationTime">14:22:52</div>
                            <div class="font-semibold text-gray-700 col-span-2">Vendor Code:</div> <div class="col-span-2" id="detailVendorCode"></div>
                            <div class="font-semibold text-gray-700 col-span-2">Vendor Desc:</div> <div class="col-span-2" id="detailVendorDesc">PT DYNAPLAST Tbk</div>
                            <div class="font-semibold text-gray-700 col-span-2">Verification No:</div> <div class="col-span-2" id="detailVerificationNo">1</div>
                            <div class="font-semibold text-gray-700 col-span-2">Invoice No:</div> <div class="col-span-2" id="detailInvoiceNo">1</div>
                            <div class="font-semibold text-gray-700 col-span-2">Invoice Date:</div> <div class="col-span-2" id="detailInvoiceDate">22-OCT-2025</div>
                            <div class="font-semibold text-gray-700 col-span-2">Term Of Payment (days):</div> <div class="col-span-2" id="detailPaymentTerms">30</div>
                        </div>
                        
                        <!-- Action Buttons - Centered relative to the entire screen width -->
                        <div class="flex flex-col items-center space-y-2">
                            <!-- Back Button -->
                            <button id="backButton" class="bg-primary-red hover:bg-[#a6392c] text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                                Back
                            </button>
                            <!-- Print Button -->
                            <button id="printButton" class="bg-pasti-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c.55 0 1 .45 1 1s-.45 1-1 1h-2c-.55 0-1-.45-1-1s.45-1 1-1h2zm-2-7H7V4h10v2z"></path></svg>
                                Print
                            </button>
                        </div>
                    </div>

                    <!-- Transaction Table -->
                    <div class="overflow-x-auto rounded-lg shadow-lg">
                        <table class="min-w-full bg-white data-table">
                            <thead class="bg-gray-200 text-gray-600 uppercase text-xs leading-normal">
                                <tr>
                                    <th class="py-3 px-3 text-left">Ref Document No.</th>
                                    <th class="py-3 px-3 text-left">Ref Document Date</th>
                                    <th class="py-3 px-3 text-left">Transaction No.</th>
                                    <th class="py-3 px-3 text-left">Transaction Date</th>
                                    <th class="py-3 px-3 text-left">Superior Doc. No.</th>
                                    <th class="py-3 px-3 text-right">Amount</th>
                                    <th class="py-3 px-3 text-left">Tax Invoice No.</th>
                                    <th class="py-3 px-3 text-left">Tax Invoice Date</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 text-sm font-light">
                                <!-- Mock Data Rows -->
                                <tr class="border-b border-gray-200 hover:bg-gray-100">
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                    <td class="py-3 px-3 text-left">46</td>
                                    <td class="py-3 px-3 text-left">23-Oct-2025</td>
                                    <td class="py-3 px-3 text-left">1</td>
                                    <td class="py-3 px-3 text-right">3,200,000.00</td>
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                </tr>
                                <tr class="border-b border-gray-200 hover:bg-gray-100">
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                    <td class="py-3 px-3 text-left">52</td>
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                    <td class="py-3 px-3 text-left">2</td>
                                    <td class="py-3 px-3 text-right">0</td>
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                    <td class="py-3 px-3 text-left">22-Oct-2025</td>
                                </tr>
                                <!-- Total Row Placeholder -->
                                <tr class="bg-gray-100 font-bold border-t-2 border-gray-400">
                                    <td colspan="5" class="py-3 px-3 text-right">Total:</td>
                                    <td class="py-3 px-3 text-right">3,200,000.00</td>
                                    <td colspan="2"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div> <!-- End Centering Wrapper -->

            </div> <!-- End Detail Screen -->

            <!-- Step 4: Report Generation Screen (Hidden) -->
            <div id="reportScreen" class="hidden flex flex-col items-center justify-center h-[500px] bg-white border border-gray-300 rounded-lg shadow-inner mt-8 mx-auto w-full max-w-lg">
                <p class="text-xl font-semibold text-gray-500">Please wait, generating report</p>
                <!-- Simple CSS spinner -->
                <div class="mt-4 animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-pasti-blue"></div>
            </div>

            <!-- Custom Modal for Messages (replaces alert()) - Hidden by default -->
            <div id="customModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4">
                <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
                    <h3 id="modalTitle" class="text-xl font-bold mb-4 text-pasti-dark-blue">Notification</h3>
                    <p id="modalMessage" class="text-gray-700 mb-6"></p>
                    <div class="flex justify-end">
                        <button id="modalCloseButton" class="bg-pasti-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                            OK
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    // Check authentication on page load
    const simulatedLogin = localStorage.getItem('simulated_login');
    const otpPassed = localStorage.getItem('simulated_otp_passed');

    if (!simulatedLogin || otpPassed !== 'true') {
        // Not authenticated, redirect to login
        window.location.href = 'login.html';
    }

    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        // Modal Elements
        const customModal = document.getElementById('customModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalCloseButton = document.getElementById('modalCloseButton');
        
        // Screens/Tabs
        const entryScreen = document.getElementById('entryScreen');
        const verificationScreen = document.getElementById('verificationScreen');
        const detailScreen = document.getElementById('detailScreen'); 
        const reportScreen = document.getElementById('reportScreen'); 

        // Tab Elements
        const allTabs = document.querySelectorAll('#tabBar .tab-item');
        
        // Entry Form Elements
        const receiptNoInput = document.getElementById('receiptNo');
        const receiptDateInput = document.getElementById('receiptDate');
        const submitButton = document.getElementById('submitButton');
        const cancelButton = document.getElementById('cancelButton');
        
        // Verification Display Elements (Updated to Span elements)
        const displayReceiptNoSpan = document.getElementById('displayReceiptNoSpan');
        const displayReceiptDateSpan = document.getElementById('displayReceiptDateSpan');
        const saveButton = document.getElementById('saveButton');
        const cancelVerificationButton = document.getElementById('cancelVerificationButton');

        // Detail Screen Elements
        const backButton = document.getElementById('backButton');
        const printButton = document.getElementById('printButton');

        // E-Verify Menu Elements
        const eVerifyMenu = document.getElementById('eVerifyMenu');
        const eVerifySubMenu = document.getElementById('eVerifySubMenu');
        const arrow = eVerifyMenu.querySelector('.arrow');


        // --- Utility Functions ---

        /** Shows a custom modal message instead of alert() or confirm() */
        function showModal(title, message, isError = false) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalTitle.className = `text-xl font-bold mb-4 ${isError ? 'text-primary-red' : 'text-pasti-dark-blue'}`;
            customModal.classList.remove('hidden');
            customModal.classList.add('flex');
        }

        modalCloseButton.onclick = () => {
            customModal.classList.add('hidden');
            customModal.classList.remove('flex');
        };

        /** Switches between the screens and updates tabs */
        function switchScreen(screen) {
            // Hide all screens
            entryScreen.classList.add('hidden');
            verificationScreen.classList.add('hidden');
            detailScreen.classList.add('hidden');
            reportScreen.classList.add('hidden');

            // Reset all tab styling and hide data tabs initially
            allTabs.forEach(tab => {
                tab.classList.remove('bg-white', 'border-b-2', 'border-primary-red', 'text-gray-900');
                tab.classList.add('bg-gray-200', 'text-gray-700', 'hidden');
            });
            
            let activeScreenElement;
            let activeTabId = '';

            if (screen === 'entry') {
                activeScreenElement = entryScreen;
                document.getElementById('receiptEntryTab').classList.remove('hidden');
                activeTabId = 'receiptEntryTab';
            } else if (screen === 'verification') {
                activeScreenElement = verificationScreen;
                document.getElementById('receiptEntryTab').classList.remove('hidden');
                document.getElementById('verificationTab').classList.remove('hidden');
                activeTabId = 'verificationTab';
            } else if (screen === 'detail') {
                activeScreenElement = detailScreen;
                document.getElementById('receiptEntryTab').classList.remove('hidden');
                document.getElementById('verificationTab').classList.remove('hidden');
                document.getElementById('detailTab').classList.remove('hidden');
                activeTabId = 'detailTab';
            } else if (screen === 'report') {
                activeScreenElement = reportScreen;
                // Keep the last step's tabs visible, but highlight the detail tab
                document.getElementById('receiptEntryTab').classList.remove('hidden');
                document.getElementById('verificationTab').classList.remove('hidden');
                document.getElementById('detailTab').classList.remove('hidden');
                activeTabId = 'detailTab'; 
            }
            
            // Show the active screen
            if (activeScreenElement) {
                activeScreenElement.classList.remove('hidden');
            }

            // Set active tab styling
            const activeTab = document.getElementById(activeTabId);
            if (activeTab) {
                activeTab.classList.remove('bg-gray-200', 'text-gray-700');
                activeTab.classList.add('bg-white', 'border-b-2', 'border-primary-red', 'text-gray-900');
            }
        }
        
        // Initialize state
        switchScreen('entry');


        // --- Event Handlers ---

        submitButton.addEventListener('click', () => {
            const receiptNo = receiptNoInput.value.trim();
            const receiptDate = receiptDateInput.value;

            if (!receiptNo || !receiptDate) {
                showModal('Validation Error', 'Both Receipt No. and Receipt Date are required.', true);
                return;
            }

            // Date formatting for DD-MON-YYYY (e.g., 22-OCT-2025)
            const dateParts = receiptDate.split('-');
            const day = dateParts[2];
            const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            // Use the Date object created from the input for correct month index
            const month = monthNames[new Date(receiptDate).getMonth()]; 
            const year = dateParts[0];
            const formattedDate = `${day}-${month}-${year}`;


            // Update display fields on the verification screen
            displayReceiptNoSpan.textContent = receiptNo;
            displayReceiptDateSpan.textContent = formattedDate; 

            // Switch to the verification screen
            switchScreen('verification');
        });

        // Handler for "Cancel" on Entry Screen
        cancelButton.addEventListener('click', () => {
            receiptNoInput.value = '';
            receiptDateInput.value = '';
            showModal('Action Cancelled', 'The receipt entry was cancelled.', false);
        });

        // Handler for "Cancel" on Verification Screen
        cancelVerificationButton.addEventListener('click', () => {
            showModal('Action Cancelled', 'Verification cancelled. Returning to entry screen.', false);
            // Return to the entry screen
            switchScreen('entry');
        });
        
        // Handler for "Save" on Verification Screen (Triggers switch to Detail Screen)
        saveButton.addEventListener('click', () => {
            // Simulate saving data. In a real app, this would be an API call.
            
            // Update Detail Screen mock data (Current Date/Time)
            const now = new Date();
            const dateOptions = { day: '2-digit', month: 'short', year: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            
            document.getElementById('detailVerificationDate').textContent = now.toLocaleDateString('en-US', dateOptions).toUpperCase().replace(/,/g, '');
            document.getElementById('detailVerificationTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
            
            // Show success message and transition to detail view
            showModal('Data Saved', 'Transaction verification successfully saved and completed.', false);
            switchScreen('detail'); 
        });

        // Handler for "Back" on Detail Screen (Mock: returns to entry screen)
        backButton.addEventListener('click', () => {
            showModal('Action', 'Returning to the initial entry screen.', false);
            switchScreen('entry');
            receiptNoInput.value = '';
            receiptDateInput.value = '';
        });

        // Handler for "Print" on Detail Screen (Triggers Report Generation Message)
        printButton.addEventListener('click', () => {
            switchScreen('report');

            // Simulate report generation delay (2 seconds)
            setTimeout(() => {
                showModal('Report Complete', 'Report generation finished. (In a real app, a file download would start here).', false);
                // Return to detail screen after generation
                switchScreen('detail');
            }, 2000);
        });

        // Handler for E-Verify Menu Toggle
        eVerifyMenu.addEventListener('click', () => {
            eVerifySubMenu.classList.toggle('hidden');
            arrow.classList.toggle('expanded');
        });
    });
</script>
</body>
</html>