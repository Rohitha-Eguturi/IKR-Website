<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasti - e-Verify - Dropbox Upload</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Custom Tailwind Configuration
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-red': '#e74c3c',
                        'nav-bg': '#000080',
                        'nav-active-bg': '#0000AA',
                        'nav-active-border': '#0000FF',
                        'table-header-bg-main': '#bdc3c7',
                        'table-header-bg-sub': '#ecf0f1',
                        'pasti-blue': '#3498db',
                        'search-button-blue': '#3498db',
                        'back-button-red': '#e74c3c',
                        'pasti-dark-blue': '#293547',
                        'success-message-green': '#2ecc71',
                        'warning-orange': '#f39c12',
                        'submit-blue': '#2C7AAB',
                        'cancel-red': '#D9534F',
                        'generate-dropbox-orange': '#f1c40f',
                        'delete-red': '#c0392b',
                    }
                }
            }
        }
    </script>
    <style>
        /* Base styles */
        body { background-color: #f0f0f0; margin: 0; font-family: 'Inter', sans-serif; }
        .app-container { display: flex; height: 100vh; }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding-top: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            overflow-y: auto;
        }

        .logo-section { padding: 10px 20px; font-size: 24px; font-weight: bold; margin-bottom: 20px; }

        .menu-item {
            display: block;
            padding: 10px 20px;
            cursor: pointer;
            border-left: 3px solid transparent;
            font-size: 14px;
            transition: background-color 0.15s;
        }

        .menu-item:hover, .menu-item.active {
            background-color: #0000AA;
            border-left: 3px solid #3498db;
        }

        /* Specific style for submenu items */
        .submenu-item {
            padding-left: 30px;
            font-size: 13px;
            background-color: #3b5066;
            border-left: none;
        }

        .submenu-item:hover { background-color: #4a647d; }

        .menu-item-group {
            font-size: 12px;
            font-weight: bold;
            padding: 10px 20px 5px;
            color: #bdc3c7;
        }

        /* Table specific styles for appearance */
        .results-table th {
            background-color: var(--tw-bg-table-header-bg-main, #bdc3c7);
            color: var(--tw-text-pasti-dark-blue, #293547);
            font-weight: bold;
            text-align: left;
            padding: 8px 12px;
            white-space: nowrap; /* Prevent headers from wrapping */
        }
        .results-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #ecf0f1;
            white-space: nowrap;
            font-size: 13px;
        }
        .results-table tbody tr:hover {
            background-color: #f7f9fa;
        }
    </style>
</head>
<body class="bg-[#f0f0f0]">

<div class="app-container">

    <div class="sidebar">
        <div class="logo-section">Pasti</div>
        <hr style="border-color: #0000AA;">
        <div class="menu-item">IT Service Management</div>
        <div class="menu-item">Finance &amp; Accounting</div>
        <div class="menu-item">E-Filing</div>
        <div class="menu-group">
            <div class="menu-item flex justify-between items-center bg-[#0000AA] border-l-3 border-[#3498db]">
                <span>e-Verify</span>
                <svg class="w-4 h-4 transform rotate-180" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </div>
            <div>
                <a href="registry_dropbox.html" class="menu-item submenu-item">Registry Dropbox</a>
                <div class="menu-item submenu-item active">Dropbox Upload</div>
                <div class="menu-item submenu-item">Print Dropbox</div>
                <div class="menu-item submenu-item">Receivable Report</div>
                <div class="menu-item submenu-item">Monitoring Transaction</div>
                <div class="menu-item submenu-item">Upload Data Payment Invoice</div>
            </div>
        </div>
        <div class="menu-item">Verification Transaction</div>
        <div class="menu-item">Re-Print Verification</div>
        <div class="menu-item">Tax Invoice Process</div>
    </div>

    <div class="flex-1 flex flex-col bg-white overflow-hidden">

        <div class="flex justify-between items-center bg-primary-red text-white p-2 text-sm shadow-md flex-shrink-0">
            <div class="flex">
                <a href="index.html" class="px-3 cursor-pointer hover:bg-white hover:text-gray-800 rounded-t-lg">&#x1F3E0; Home</a>
                <div class="px-3 bg-white text-gray-800 font-semibold rounded-t-lg">Dropbox Upload <span class="ml-2 cursor-pointer">&times;</span></div>
            </div>
            <div id="currentDateTime"></div>
        </div>

        <div class="flex-1 p-8 overflow-y-auto bg-gray-50">
            <h1 class="text-2xl font-bold mb-6 text-pasti-dark-blue border-b pb-2">Dropbox Upload</h1>

            <div class="max-w-6xl mx-auto bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-6">

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-12 gap-y-4">

                    <div class="flex items-center sm:col-span-1">
                        <label for="supplierId" class="font-semibold text-gray-700 w-48 flex-shrink-0">Supplier ID:</label>
                        <input type="text" id="supplierId" class="w-full border-gray-300 rounded-md p-2 text-sm border focus:ring-pasti-blue focus:border-pasti-blue" placeholder="Enter Supplier ID">
                    </div>
                    <div class="flex items-center sm:col-span-2 lg:col-span-1">
                        <label for="regNo" class="font-semibold text-gray-700 w-48 flex-shrink-0">Verification/Registration No:</label>
                        <input type="text" id="regNo" class="w-full border-gray-300 rounded-md p-2 text-sm border focus:ring-pasti-blue focus:border-pasti-blue" placeholder="Enter Registration No">
                    </div>

                    <div class="flex items-center sm:col-span-1">
                        <label for="supplierDesc" class="font-semibold text-gray-700 w-48 flex-shrink-0">Supplier Description:</label>
                        <input type="text" id="supplierDesc" value="" class="w-full border-gray-300 rounded-md p-2 text-sm border focus:ring-pasti-blue focus:border-pasti-blue" placeholder="Enter Description">
                    </div>
                    <div class="flex items-center sm:col-span-1">
                        <label for="dropboxCode" class="font-semibold text-gray-700 w-48 flex-shrink-0">Dropbox Code:</label>
                        <input type="text" id="dropboxCode" class="w-full border-gray-300 rounded-md p-2 text-sm border focus:ring-pasti-blue focus:border-pasti-blue" placeholder="Enter Dropbox Code">
                    </div>

                    <div class="flex items-center sm:col-span-1">
                        <label for="verificationDate" class="font-semibold text-gray-700 w-48 flex-shrink-0">Verification/Registration Date:</label>
                        <input type="date" id="verificationDate" value="2025-11-06" class="w-full border-gray-300 rounded-md p-2 text-sm border focus:ring-pasti-blue focus:border-pasti-blue">
                    </div>

                    <div class="flex justify-end space-x-4 sm:col-span-2 lg:col-span-1">
                        <button id="searchButton" class="bg-search-button-blue hover:bg-pasti-blue text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            Search
                        </button>
                        <button id="resetButton" class="bg-cancel-red hover:bg-[#C9302C] text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 0012 4.043c-3.189 0-5.908 1.545-7.656 3.907M1.5 10v5h.582m15.356 2A8.001 8.001 0 0012 19.957c3.189 0 5.908-1.545 7.656-3.907"></path></svg>
                            Reset
                        </button>
                    </div>

                </div>
            </div>

            <div class="max-w-6xl mx-auto bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="font-semibold text-gray-700">Dropbox Code:</label>
                        <span id="dropboxCodeDisplay" class="ml-2 text-gray-900">DBX-2025123</span>
                    </div>
                    <div>
                        <label class="font-semibold text-gray-700">Generated Date:</label>
                        <span id="generatedDate" class="ml-2 text-gray-900">06-NOV-2025</span>
                    </div>
                </div>
            </div>

            <div class="max-w-6xl mx-auto flex justify-start space-x-3 mb-3">
                <button id="generateDropboxBtn" class="bg-generate-dropbox-orange hover:bg-[#d4ac0d] text-gray-900 font-bold py-2 px-4 rounded-lg shadow-md text-sm transition duration-150">
                    Generate Dropbox (max 6 invoices)
                </button>
                <button class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md text-sm transition duration-150">
                    Save as Draft
                </button>
                <button id="submitDropboxBtn" class="bg-submit-blue hover:bg-[#20608F] text-white font-bold py-2 px-4 rounded-lg shadow-md text-sm transition duration-150">
                    Submit Dropbox
                </button>
                <div class="flex-grow"></div>
                <button class="bg-delete-red hover:bg-[#a62c1e] text-white font-bold py-2 px-4 rounded-lg shadow-md text-sm transition duration-150">
                    Delete Dropbox
                </button>
                <button class="bg-pasti-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md text-sm transition duration-150">
                    Report &amp; Print
                </button>
            </div>

            <div class="max-w-6xl mx-auto overflow-x-auto rounded-xl shadow-lg border border-gray-300">
                <table class="min-w-full bg-white results-table">
                    <thead>
                        <tr>
                            <th class="py-3 px-3 text-center w-12">No.</th>
                            <th class="py-3 px-3 text-center w-12"><input type="checkbox" id="selectAll"></th>
                            <th class="py-3 px-3">Verif. No.</th>
                            <th class="py-3 px-3">Receipt No.</th>
                            <th class="py-3 px-3">Receipt Date</th>
                            <th class="py-3 px-3">Currency</th>
                            <th class="py-3 px-3 text-right">Amount (PPN/PPnBM)</th>
                            <th class="py-3 px-3 text-right">Total Payment</th>
                            <th class="py-3 px-3">BAST Date</th>
                            <th class="py-3 px-3 text-right">BAST Qty</th>
                            <th class="py-3 px-3">Tax Invoice</th>
                            <th class="py-3 px-3">Status</th>
                            <th class="py-3 px-3">Supplier Name</th>
                            <th class="py-3 px-3">NPWP Supplier</th>
                            <th class="py-3 px-3">Address</th>
                            <th class="py-3 px-3 text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody id="invoiceTableBody" class="text-gray-700">
                        </tbody>
                </table>
            </div>

            <div id="customModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4 z-50">
                <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
                    <h3 id="modalTitle" class="text-xl font-bold mb-4 text-pasti-dark-blue">Notification</h3>
                    <p id="modalMessage" class="text-gray-700 mb-6"></p>
                    <div class="flex justify-end space-x-2">
                        <button id="modalCancelButton" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                            Cancel
                        </button>
                        <button id="modalOkButton" class="bg-pasti-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                            OK
                        </button>
                    </div>
                </div>
            </div>
        
            <p class="text-center text-sm text-gray-400 mt-12">Dropbox Upload Module (e-Verify Section)</p>
        </div>
    </div>
</div>

<script>
    // Check authentication on page load
    const simulatedLogin = localStorage.getItem('simulated_login');
    const otpPassed = localStorage.getItem('simulated_otp_passed');

    if (!simulatedLogin || otpPassed !== 'true') {
        // Not authenticated, redirect to login
        // window.location.href = 'login.html'; // Disabled for demo
    }

    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const generateDropboxBtn = document.getElementById('generateDropboxBtn');
        const invoiceTableBody = document.getElementById('invoiceTableBody');
        const selectAllCheckbox = document.getElementById('selectAll');
        const submitDropboxBtn = document.getElementById('submitDropboxBtn');

        // Modal Elements
        const customModal = document.getElementById('customModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalOkButton = document.getElementById('modalOkButton');
        const modalCancelButton = document.getElementById('modalCancelButton');

        // --- Mock Data (Updated to 6 Items) ---
        const mockDropboxData = [
            { id: 1, verifNo: 'V-100', receiptNo: 'R-5000', receiptDate: '26-OCT-2025', currency: 'IDR', amount: 3200000.00, totalPayment: 3520000.00, bastDate: '27-OCT-2025', bastQty: 10, taxInvNo: '', supplierName: 'Supplier A', npwp: '99.999.999.9-999.999', address: 'Jakarta P', status: '' },
            { id: 2, verifNo: 'V-101', receiptNo: 'R-5001', receiptDate: '27-OCT-2025', currency: 'IDR', amount: 450000.00, totalPayment: 495000.00, bastDate: '27-OCT-2025', bastQty: 10, taxInvNo: '', supplierName: 'Supplier B', npwp: '99.999.999.9-999.999', address: 'Bandung D', status: '' },
            { id: 3, verifNo: 'V-102', receiptNo: 'R-5002', receiptDate: '28-OCT-2025', currency: 'IDR', amount: 1500000.00, totalPayment: 1650000.00, bastDate: '29-OCT-2025', bastQty: 20, taxInvNo: '', supplierName: 'Supplier C', npwp: '99.999.999.9-999.999', address: 'Surabaya S', status: '' },
            { id: 4, verifNo: 'V-103', receiptNo: 'R-5003', receiptDate: '29-OCT-2025', currency: 'IDR', amount: 2000000.00, totalPayment: 2200000.00, bastDate: '30-OCT-2025', bastQty: 15, taxInvNo: '', supplierName: 'Supplier D', npwp: '99.999.999.9-999.999', address: 'Medan M', status: '' },
            { id: 5, verifNo: 'V-104', receiptNo: 'R-5004', receiptDate: '30-OCT-2025', currency: 'IDR', amount: 1200000.00, totalPayment: 1320000.00, bastDate: '31-OCT-2025', bastQty: 8, taxInvNo: '', supplierName: 'Supplier E', npwp: '99.999.999.9-999.999', address: 'Bali B', status: '' },
            { id: 6, verifNo: 'V-105', receiptNo: 'R-5005', receiptDate: '31-OCT-2025', currency: 'IDR', amount: 3500000.00, totalPayment: 3850000.00, bastDate: '01-NOV-2025', bastQty: 25, taxInvNo: '', supplierName: 'Supplier F', npwp: '99.999.999.9-999.999', address: 'Semarang S', status: '' },
        ];

        // Check if PDF was uploaded successfully
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('uploaded') === 'true') {
            mockDropboxData[0].status = 'Ok pdf'; // Set status for first item
        }

        // --- Utility Functions ---

        function updateDateTime() {
            const now = new Date();
            const formattedDate = now.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' }).toUpperCase().replace(/,/g, '');
            const formattedTime = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            document.getElementById('currentDateTime').textContent = `${formattedDate} ${formattedTime}`;
        }
        setInterval(updateDateTime, 1000);
        updateDateTime(); 

        function hideModal() {
            customModal.classList.add('hidden');
            customModal.classList.remove('flex');
            modalOkButton.textContent = 'OK';
            modalOkButton.className = 'bg-pasti-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150';
            modalCancelButton.textContent = 'Cancel';
            modalCancelButton.className = 'bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-150';
            modalCancelButton.style.display = 'inline-block'; 
            modalOkButton.onclick = hideModal; 
            modalCancelButton.onclick = hideModal;
            modalTitle.textContent = 'Notification'; 
            modalTitle.className = 'text-xl font-bold mb-4 text-pasti-dark-blue';
        }

        function showConfirmModal(title, messageHtml, onSaveAction, onCancelAction) {
            modalTitle.textContent = title;
            modalMessage.innerHTML = messageHtml;
            modalCancelButton.textContent = 'Cancel';
            modalCancelButton.className = 'bg-cancel-red hover:bg-[#C9302C] text-white font-bold py-2 px-4 rounded-lg transition duration-150';
            modalCancelButton.onclick = onCancelAction || hideModal;
            modalOkButton.textContent = 'Save';
            modalOkButton.className = 'bg-search-button-blue hover:bg-pasti-blue text-white font-bold py-2 px-4 rounded-lg transition duration-150';
            modalOkButton.onclick = onSaveAction; 
            modalCancelButton.style.display = 'inline-block';
            customModal.classList.remove('hidden');
            customModal.classList.add('flex');
        }

        function showModal(title, message, isError = false) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalTitle.className = `text-xl font-bold mb-4 ${isError ? 'text-primary-red' : 'text-pasti-dark-blue'}`;
            modalOkButton.textContent = 'OK';
            modalOkButton.className = 'bg-pasti-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150';
            modalCancelButton.style.display = 'none'; 
            modalOkButton.onclick = hideModal;
            customModal.classList.remove('hidden');
            customModal.classList.add('flex');
        }

        function formatCurrency(number) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(number);
        }

        function renderTable(data) {
            invoiceTableBody.innerHTML = '';
            if (data.length === 0) {
                invoiceTableBody.innerHTML = '<tr><td colspan="16" class="text-center py-6 text-gray-500">No invoices in dropbox.</td></tr>';
                selectAllCheckbox.checked = false;
                selectAllCheckbox.disabled = true;
                return;
            }
            selectAllCheckbox.disabled = false;
            data.forEach((invoice, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-3 text-center">${index + 1}</td>
                    <td class="py-3 px-3 text-center"><input type="checkbox" data-id="${invoice.id}" class="invoice-checkbox"></td>
                    <td class="py-3 px-3 font-medium">${invoice.verifNo}</td>
                    <td class="py-3 px-3">${invoice.receiptNo}</td>
                    <td class="py-3 px-3">${invoice.receiptDate}</td>
                    <td class="py-3 px-3">${invoice.currency}</td>
                    <td class="py-3 px-3 text-right">${formatCurrency(invoice.amount)}</td>
                    <td class="py-3 px-3 text-right font-semibold">${formatCurrency(invoice.totalPayment)}</td>
                    <td class="py-3 px-3">${invoice.bastDate}</td>
                    <td class="py-3 px-3 text-right">${invoice.bastQty}</td>
                    <td class="py-3 px-3 text-center">
                        <button class="bg-pasti-blue hover:bg-blue-700 text-white text-xs font-semibold py-1 px-2 rounded" onclick="uploadTaxInvoice(${invoice.id})">Upload</button>
                    </td>
                    <td class="py-3 px-3 text-center" id="status-${invoice.id}">${invoice.status || ''}</td>
                    <td class="py-3 px-3">${invoice.supplierName}</td>
                    <td class="py-3 px-3">${invoice.npwp}</td>
                    <td class="py-3 px-3">${invoice.address}</td>
                    <td class="py-3 px-3 text-center">
                        <button class="text-pasti-blue hover:text-blue-700 text-xs font-semibold" onclick="viewDetail(${invoice.id})">VIEW</button>
                    </td>
                `;
                invoiceTableBody.appendChild(row);
            });
        }

        window.viewDetail = function(id) {
            showModal('Invoice Detail', `Viewing details for Invoice ID: ${id}.`, false);
        };

        window.uploadTaxInvoice = function(id) {
            const invoice = mockDropboxData.find(inv => inv.id === id);
            const fileName = invoice ? `invoice_${invoice.verifNo}.pdf` : 'invoice_document.pdf';
            window.location.href = `upload_document.html?invoiceId=${id}&fileName=${encodeURIComponent(fileName)}`;
        };

        selectAllCheckbox.addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            document.querySelectorAll('.invoice-checkbox').forEach(checkbox => {
                checkbox.checked = isChecked;
            });
        });

        generateDropboxBtn.addEventListener('click', () => {
            showModal('Generate Dropbox', 'Dropbox already generated. This is the upload page.', false);
        });
        
        submitDropboxBtn.addEventListener('click', () => {
            const selectedCheckboxes = document.querySelectorAll('.invoice-checkbox:checked');
            if (selectedCheckboxes.length === 0) {
                showModal('Validation Error', 'Please select at least one receipt to submit.', true);
                return;
            }
            const handleSave = () => {
                hideModal();
                window.location.href = 'print_dropbox.html'; 
            };
            const handleCancel = () => {
                hideModal();
            };
            const modalHtml = `
                <div class="text-2xl font-bold text-warning-orange mb-3">Warning</div>
                <p class="text-gray-700">Are you sure to submit transaction? After submission, you will be redirected to the Print Dropbox page.</p>
            `;
            showConfirmModal('', modalHtml, handleSave, handleCancel);
        });

        renderTable(mockDropboxData);
    });
</script>
</body>
</html>
